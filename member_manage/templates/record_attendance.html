{% extends "home.html" %}
{% load static %}
{% block main_content %}
<link rel="stylesheet" href="{% static 'css/record_attendance.css' %}">
<section class="attendance-section">
    <h2>Record Attendance</h2>
    {% if message %}
        <div class="status-message">{{ message }}</div>
    {% endif %}
    <!-- Event Filter Row -->
    <form id="eventFilterForm" class="filter-row" method="get" action="{% url 'record_attendance' %}">
        <select name="event_id" id="event_id" required>
            <option value="">Select Event</option>
            {% for event in events %}
                <option value="{{ event.id }}" {% if event.id|stringformat:"s" == selected_event_id %}selected{% endif %}>
                    {{ event.event_name }} - {{ event.event_date }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="filter-btn" title="Apply"><i class="fas fa-filter"></i></button>
        <button type="button" class="reset-btn" id="resetFilterBtn" title="Reset"><i class="fas fa-undo"></i></button>
        <button type="button" class="download-btn" id="downloadBtn" title="Download"><i class="fas fa-download"></i></button>
    </form>

    <!-- Event Details Row -->
    {% if selected_event %}
    <div class="event-details-row">
        <input type="text" value="{{ selected_event.event_name }}" readonly placeholder="Event Name" />
        <input type="text" value="{{ selected_event.event_date }}" readonly placeholder="Event Date" />
        <input type="text" value="{{ selected_event.instructor_name }}" readonly placeholder="Instructor" />
        <input type="text" value="{{ selected_event.location }}" readonly placeholder="Location" />
        <input type="text" value="{{ selected_event.state }}" readonly placeholder="State" />
        <input type="text" value="{{ selected_event.city }}" readonly placeholder="City" />
        <input type="text" value="{{ selected_event.country }}" readonly placeholder="Country" />
        <input type="text" value="{{ selected_event.total_attendance }}" readonly placeholder="Total Attendance" />
    </div>
    {% endif %}

    <!-- Attendance Register -->
    {% if selected_event %}
    <form id="attendanceRegisterForm" method="post" action="{% url 'record_attendance' %}?event_id={{ selected_event.id }}">
        {% csrf_token %}
        <div class="attendance-register-header">
            <span>Attendance Register</span>
            <div>
                <button type="button" class="add-member-btn" id="addMemberBtn">Add Member</button>
                <button type="button" class="remove-member-btn" id="removeMemberBtn">Remove Member</button>
            </div>
        </div>
        <div id="attendanceRows">
            <!-- Dynamic member rows will be inserted here -->
        </div>
        <div class="form-actions">
            <button type="submit" class="save-btn">Save</button>
            <button type="button" class="reset-btn" id="resetRegisterBtn">Reset</button>
            <a href="{% url 'dashboard' %}" class="close-btn">Close</a>
        </div>
    </form>
    {% endif %}
</section>
<script src="{% static 'js/record_attendance.js' %}"></script>
{% endblock %}

